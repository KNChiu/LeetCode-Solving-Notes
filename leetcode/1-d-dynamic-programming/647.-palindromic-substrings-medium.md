---
description: Two Pointers, String, Dynamic Programming
---

# 647. Palindromic Substrings - Medium

## 釐清需求與邊界條件

* **輸入**: 一個字符串 s
* **輸出**: s 中所有回文子串的總數
* **邊界條件**:
  * 字符串長度可能為 0 或 1
  * 字符串長度不超過 1000
  * 字符串僅包含小寫英文字母

## 口述解法

* 使用了中心擴展法來計算回文子串的數量。
* **主要函數**: `countSubstrings`
  * 初始化答案計數器 `ans` 為 0，並獲取字符串長度 `n`
  * 對於每個可能的中心點（共 2n-1 個，包括字符本身和字符之間的位置）:
    * 計算當前中心左右兩個索引 `i` 和 `j`
    * 當索引有效且左右字符相等時，向兩側擴展:
      * 每找到一個回文子串就增加計數
      * 通過減少 `i` 和增加 `j` 來向外擴展
  * 返回總計數 `ans`
* **關鍵思路說明**:
  * 回文串可以有兩種中心: 單個字符（奇數長度）或兩個字符之間的位置（偶數長度）
  * 例如 "aba" 的中心是 'b'，而 "abba" 的中心是 'b' 和 'b' 之間
  * 通過 `k // 2` 和 `(k + 1) // 2` 巧妙地處理了奇偶兩種情況
  * `~i` 是 `i >= 0` 的位元操作替代

## 測試與優化

* 程式碼

```python
class Solution:
    def countSubstrings(self, s: str) -> int:
        ans, n = 0, len(s)
        for k in range(n * 2 - 1):
            i, j = k // 2, (k + 1) // 2
            while i >= 0 and j < n and s[i] == s[j]:
                ans += 1
                i, j = i - 1, j + 1
        return ans
```

## 時間與空間複雜度

* **時間複雜度**: O(n²)
  * 外層循環執行 O(n) 次
  * 內層循環在最壞情況下也是 O(n)，例如對於 "aaa" 這樣的輸入
  * 總體為 O(n²)
* **空間複雜度**: O(1)
  * 只使用了常數額外空間，不隨輸入規模變化
